{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport axios from \"axios\";\nimport { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useNavigate } from \"react-router-dom\";\nimport Cookies from \"universal-cookie\";\nimport { setCredentials } from \"../features/auth/authSlice\";\nexport const useAuth = () => {\n  _s();\n\n  console.log(\"API\", process.env.REACT_APP_SERVER_API);\n  const [isLoading, setIsLoading] = useState(false);\n  const cookies = new Cookies();\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const [errorMsg, setErrorMsg] = useState(\"\");\n\n  const signin = async _ref => {\n    let {\n      username,\n      password\n    } = _ref;\n    authApi({\n      type: \"signin\",\n      username,\n      password\n    });\n  };\n\n  const signup = async _ref2 => {\n    let {\n      username,\n      password\n    } = _ref2;\n    setIsLoading(true);\n    authApi({\n      type: \"signup\",\n      username,\n      password\n    });\n  };\n\n  const authApi = async _ref3 => {\n    let {\n      type,\n      username,\n      password\n    } = _ref3;\n\n    try {\n      var _response$data;\n\n      const response = await axios.post(`${process.env.REACT_APP_SERVER_API}/auth/local/${type}`, JSON.stringify({\n        username,\n        password\n      }), {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      const d = new Date();\n      d.setMinutes(d.getMinutes() + 15);\n      cookies.set(\"token\", response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.access_token, {\n        path: \"/\",\n        expires: d\n      });\n      dispatch(setCredentials({ ...(response === null || response === void 0 ? void 0 : response.data)\n      }));\n      navigate(\"/\");\n      console.log(JSON.stringify(response === null || response === void 0 ? void 0 : response.data));\n    } catch (err) {\n      var _err$response;\n\n      setIsLoading(false);\n\n      if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 403) {\n        if (type === \"signin\") {\n          setErrorMsg(\"Wrong username or password\");\n        } else {\n          setErrorMsg(\"User already exists\");\n        }\n      } else {\n        setErrorMsg(\"Login failed\");\n      }\n    }\n  };\n\n  return {\n    isLoading,\n    errorMsg,\n    signin,\n    signup\n  };\n};\n\n_s(useAuth, \"EyY1YjdSTQXrzP63CGJsAixekf8=\", false, function () {\n  return [useDispatch, useNavigate];\n});","map":{"version":3,"names":["axios","useState","useDispatch","useNavigate","Cookies","setCredentials","useAuth","console","log","process","env","REACT_APP_SERVER_API","isLoading","setIsLoading","cookies","dispatch","navigate","errorMsg","setErrorMsg","signin","username","password","authApi","type","signup","response","post","JSON","stringify","headers","d","Date","setMinutes","getMinutes","set","data","access_token","path","expires","err","status"],"sources":["/Users/tomas/Documents/Github/ababa-task/client/src/hooks/useAuth.ts"],"sourcesContent":["import axios from \"axios\";\nimport { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useNavigate } from \"react-router-dom\";\nimport Cookies from \"universal-cookie\";\nimport { setCredentials } from \"../features/auth/authSlice\";\n\ninterface User {\n  username: string;\n  password: string;\n}\n\nexport const useAuth = () => {\n  console.log(\"API\", process.env.REACT_APP_SERVER_API);\n  const [isLoading, setIsLoading] = useState(false);\n  const cookies = new Cookies();\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const [errorMsg, setErrorMsg] = useState(\"\");\n\n  const signin = async ({ username, password }: User) => {\n    authApi({ type: \"signin\", username, password });\n  };\n  const signup = async ({ username, password }: User) => {\n    setIsLoading(true);\n\n    authApi({ type: \"signup\", username, password });\n  };\n\n  const authApi = async ({\n    type,\n    username,\n    password,\n  }: {\n    type: string;\n    username: string;\n    password: string;\n  }) => {\n    try {\n      const response = await axios.post(\n        `${process.env.REACT_APP_SERVER_API}/auth/local/${type}`,\n        JSON.stringify({ username, password }),\n        {\n          headers: { \"Content-Type\": \"application/json\" },\n        }\n      );\n      const d = new Date();\n      d.setMinutes(d.getMinutes() + 15);\n      cookies.set(\"token\", response?.data?.access_token, {\n        path: \"/\",\n        expires: d,\n      });\n      dispatch(setCredentials({ ...response?.data }));\n      navigate(\"/\");\n      console.log(JSON.stringify(response?.data));\n    } catch (err: any) {\n      setIsLoading(false);\n      if (err.response?.status === 403) {\n        if (type === \"signin\") {\n          setErrorMsg(\"Wrong username or password\");\n        } else {\n          setErrorMsg(\"User already exists\");\n        }\n      } else {\n        setErrorMsg(\"Login failed\");\n      }\n    }\n  };\n\n  return { isLoading, errorMsg, signin, signup };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}